# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#
# If server is set, a gRPC endpoint is exposed the full load generator's API.
server:
  endpoint: :8001
  tls:
    # TLS configuration being built based on the tls mode chosen: none, tls, mtls.
    mode: mtls
    cert-path: /server-certs/public-key.pem
    key-path: /server-certs/private-key.pem
    ca-cert-paths:
      - /server-certs/ca-certificate.pem
# If http-server is set, an HTTP endpoint is exposed to adjust the rate limit at runtime.
# It exposes the following API:
# GET  /getRateLimit - Get the rate limit returning a JSON body { "rate": uint64 }.
# POST /setRateLimit - Sets the rate limit using a JSON body { "rate": uint64 }.
http-server:
  endpoint: :6997
monitoring:
  server:
    endpoint: :2118
    # Rate limiting configuration for unary gRPC endpoints.
    # Uses a token bucket algorithm to limit the number of requests per second.
    rate-limit:
      # Maximum number of requests per second allowed.
      # Set to 0 to disable rate limiting.
      requests-per-second: 0
      # Maximum number of requests allowed in a single burst.
      # When rate limiting is enabled (requests-per-second > 0):
      #   - Must be greater than 0
      #   - Must be less than or equal to requests-per-second
      burst: 0
  latency:
    sampler:
      portion: 0.01
    buckets:
      distribution: uniform
      max-latency: 5s
      bucket-count: 1000

orderer-client:
  sidecar-client:
    endpoint: sidecar:4001
    # TLS configuration being built based on the tls mode chosen: none, tls, mtls.
    tls:
      mode: mtls
      cert-path: /client-certs/public-key.pem
      key-path: /client-certs/private-key.pem
      ca-cert-paths:
        - /client-certs/ca-certificate.pem
  orderer:
    # Organizations map organization MSP IDs to their orderer connection details.
    # It supports multi-organization deployments where each org has its own orderers and TLS root CAs.
    organizations:
      org0:
        endpoints:
          - id=0,broadcast,deliver,orderer:7050
        ca-cert-paths:
          - /client-certs/ca-certificate.pem
    # Loadgen uses these TLS credentials when connecting to the orderers as a client.
    tls:
      # TLS configuration being built based on the tls mode chosen: none, tls, mtls.
      mode: mtls
      cert-path: /client-certs/public-key.pem
      key-path: /client-certs/private-key.pem
      common-ca-cert-paths:
        - /client-certs/ca-certificate.pem
    consensus-type: BFT
    channel-id: mychannel
  # We set low values to reduce the CPU load during tests.
  broadcast-parallelism: 1

load-profile:
  key:
    size: 32
  # block describes generate block characteristics
  # (when applying load to the VC or Verifier, blocks are translated to batches).
  # The generated block size is aimed to be max-size, if the generated
  # TXs rate is sufficient.
  # If the generated TXs rate is too low, the block size might
  # be less than max-size, but at least min-size.
  # In such case, the block is generated at a preferred rate of preferred-rate.
  # Blocks wait up to preferred-rate (default: 1 second) before submission.
  # If a full block is not ready by then, a partial block is
  # submitted if it meets min-size (default: 1);
  # otherwise, the system waits until min-size is available.
  # If the max-size is less than or equal to min-size, preferred-rate is ignored.
  block:
    max-size: 500
    min-size: 10
    preferred-rate: 1s
  transaction:
    read-write-count:
      const: 2
  policy:
    channel-id: mychannel
    namespace-policies:
      0:
        # Supported schemes: MSP, ECDSA, EDDSA, and BLS
        # If MSP is used, the default policy is requiring
        # endorsement by all peer organizations.
        scheme: ECDSA
        seed: 10
      _meta:
        scheme: ECDSA
        seed: 11
    orderer-endpoints:
      - id=0,msp-id=org,broadcast,deliver,orderer:7050
    # crypto-material-path may specify the path to the material generated by `loadgen make-material`.
    # If this field is empty, the material will be generated into a temporary folder,
    # which will be printed by the loadgen CLI  tool.
    # If this path does not exist, or it is empty, the material will be generated into it.
    crypto-material-path: /root/material
  conflicts:
    invalid-signatures: 0.1
  seed: 12345
  # We set low values to reduce the CPU load during tests.
  workers: 1

stream:
  # TXs are released at rate (default: unlimited).
  rate-limit: 10_000
  # We set low values to reduce the CPU load during tests.
  buffers-size: 10
  gen-batch: 10
generate:
  namespaces: true
  load: true

# The stopping condition for generating load according to the collected metrics.
# Zero value indicate no limit.
# The limit on the number of TXs is applied at block granularity. I.e., more TXs might be created than expected
# if a block overshot.
# The load generator stops when both requirements are met, i.e., one of them might overshoot.
# For the orderer adapter, the blocks limit is ignored for broadcasting as we don't track submitted blocks.
# For adapters that use concurrent submitters, we cannot enforce exact limits.
# The sidecar and coordinator adapters are sequential, so they don't have these issues.
limit:
  blocks: 0
  transactions: 50_000

logging:
  enabled: true
  development: false
  level: INFO
  name: loadgen
