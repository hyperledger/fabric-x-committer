# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#
# Configuration for the server
server:
  endpoint: {{ .ServiceEndpoints.Server | default "localhost:0" }}
  tls:
    mode: {{ .ServiceTLS.Mode }}
    key-path: {{ .ServiceTLS.KeyPath }}
    cert-path: {{ .ServiceTLS.CertPath }}
    ca-cert-paths:
      {{- range .ServiceTLS.CACertPaths }}
      - {{ . }}
      {{- end }}
  {{- if .RateLimit }}
  # Rate limiting configuration for unary gRPC endpoints.
  # Uses a token bucket algorithm to limit the number of requests per second.
  rate-limit:
    # Maximum number of requests per second allowed.
    # Set to 0 to disable rate limiting.
    requests-per-second: {{ .RateLimit.RequestsPerSecond }}
    # Maximum number of requests allowed in a single burst.
    # Must be greater than 0 and less than or equal to requests-per-second.
    burst: {{ .RateLimit.Burst }}
  {{- end }}
monitoring:
  server:
    endpoint: {{ .ServiceEndpoints.Metrics | default "localhost:0" }}

database:
  endpoints:
    {{- range .DB.Endpoints }}
    - {{ . }}
    {{- end }}
  username: "yugabyte"
  # TODO: pass password via environment variable
  password: {{ .DB.Password }}
  database: {{ .DB.Name }}
  load-balance: {{ .DB.LoadBalance }}
  tls:
    mode: {{ .DB.TLS.Mode }}
    ca-cert-path: {{ .DB.TLS.CACertPath }}
  max-connections: 10
  min-connections: 5
  retry:
    max-elapsed-time: 1h

max-request-keys: {{ .MaxRequestKeys }}

logging:
  enabled: {{ .Logging.Enabled }}
  level: {{ .Logging.Level }}
  caller: {{ .Logging.Caller }}
  development: {{ .Logging.Development }}
  output: {{ .Logging.Output }}
  name: query
