# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#
server:
  endpoint: {{ .ThisService.GrpcEndpoint | default "localhost:0" }}
  tls:
    mode: {{ .ThisService.GrpcTLS.Mode }}
    key-path: {{ .ThisService.GrpcTLS.KeyPath }}
    cert-path: {{ .ThisService.GrpcTLS.CertPath }}
    ca-cert-paths:
      {{- range .ThisService.GrpcTLS.CACertPaths }}
      - {{ . }}
      {{- end }}
  keep-alive:
    params:
      time: 300s
      timeout: 600s
    enforcement-policy:
      min-time: 60s
      permit-without-stream: false
  {{- if .RateLimit }}
  # Rate limiting configuration for unary gRPC endpoints.
  # Uses a token bucket algorithm to limit the number of requests per second.
  rate-limit:
    # Maximum number of requests per second allowed.
    # Set to 0 to disable rate limiting.
    requests-per-second: {{ .RateLimit.RequestsPerSecond }}
    # Maximum number of requests allowed in a single burst.
    # Must be greater than 0 and less than or equal to requests-per-second.
    burst: {{ .RateLimit.Burst }}
  {{- end }}
monitoring:
  endpoint: {{ .ThisService.MetricsEndpoint | default "localhost:0" }}
  tls:
    mode: {{ .ThisService.MetricsTLS.Mode }}
    key-path: {{ .ThisService.MetricsTLS.KeyPath }}
    cert-path: {{ .ThisService.MetricsTLS.CertPath }}
    ca-cert-paths:
      {{- range .ThisService.MetricsTLS.CACertPaths }}
      - {{ . }}
      {{- end }}

orderer:
  channel-id: {{ .Policy.ChannelID }}
  consensus-type: BFT
  organizations:
    org0:
      endpoints:
        {{- range .Services.Orderer }}
        - id=0,broadcast,deliver,{{ .GrpcEndpoint }}
        {{- end }}
      ca-cert-paths:
        {{- range .ClientTLS.CACertPaths }}
        - {{ . }}
        {{- end }}
  tls:
    mode: {{ .ClientTLS.Mode }}
    cert-path: {{ .ClientTLS.CertPath }}
    key-path: {{ .ClientTLS.KeyPath }}
    common-ca-cert-paths:
      {{- range .ClientTLS.CACertPaths }}
      - {{ . }}
      {{- end }}
  identity:
    msp-id: peer-org-0
    msp-dir: {{ .Policy.CryptoMaterialPath }}/peerOrganizations/peer-org-0/users/client@peer-org-0.com/msp
    bccsp:
      Default: SW
      SW:
        Security: 256
        Hash: SHA2
committer:
  endpoint: {{ .Services.Coordinator.GrpcEndpoint }}
  tls:
    mode: {{ .ClientTLS.Mode }}
    cert-path: {{ .ClientTLS.CertPath }}
    key-path: {{ .ClientTLS.KeyPath }}
    ca-cert-paths:
      {{- range .ClientTLS.CACertPaths }}
      - {{ . }}
      {{- end }}

ledger:
  path: {{ .LedgerPath }}
  sync-interval: 100

notification:
  max-timeout: 10m
  max-concurrent-streams: 0  # 0 = unlimited

last-committed-block-set-interval: 5s
waiting-txs-limit: 20_000_000
channel-buffer-size: 100

bootstrap:
  genesis-block-file-path: {{ .ConfigBlockPath }}

logging:
  logSpec: {{ .Logging.LogSpec }}
  format: {{ .Logging.Format }}
